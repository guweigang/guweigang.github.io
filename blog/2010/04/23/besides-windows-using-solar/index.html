<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>再说Windows下使用solar - 闭眼听世界</title>
    <meta charset="utf-8" />
    <meta name="author" content="Gu Weigang" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
  </head>
  <body class="container">
    <div> 
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">闭眼听世界</a></h1>
        <p>心如松静意无尘，气若浮萍了无痕！</p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/wiki/">Wiki</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="https://github.com/guweigang">GitHub</a></li>
          <li><a href="https://google.com/search?q=site:guweigang.com">Search</a></li>
        </ul>
      </header>
    </div>
    <div> 
      <div class="post">
        <h1>再说Windows下使用solar</h1>
        <p>
前面我有篇博文“<a href="http://roygu.com/?p=477">也说windows下使用Solar</a>”中讲到，通过在/docroot/index.php文件中加入一段小代码可以浏览你的应用，但是现在在windows下使用Solar是不明智的。今天我要否决这个观点，solar-phper的福音到了。现在你可以在windows下布署并开发solar了。特别提醒：必须是windows vista以上的版本才支持类似于unix风格的symlink。
</p>

<p>
最应该感谢的是Sanakan，它在<a href="http://solarphp.org.cn/viewtopic.php?f=6&t=65">也说windows下使用Solar</a>和<a href="http://solarphp.org.cn/viewtopic.php?f=6&t=66">Windows XP下junction工具和Solar</a>
两篇帖子中阐明了整个过程，做出了重要贡献。
</p>

<p>
首先，为了能够浏览Solar应用，你仍需要在/docroot/index.php文件中加入条件：
</p>


<pre class="example">
if (strtolower(substr(PHP_OS, 0, 3)) == 'win') {
   // windows doesn't like the default symlinks
   set_include_path("$system/include;$system/source/solar");
} else {
   // unix
   set_include_path("$system/include");
}
</pre>



<p>
其次就是CLI了，打开/script/solar文件，找到17行，修改$dirs数组：
</p>


<pre class="example">
if (strtolower(substr(PHP_OS, 0, 3)) == 'win') {
 $vendor_dir = $vendor?"\\$vendor":$vendor;
    $dirs = array(
        // source solar
       "\source\solar\script\solar",
     // source vendor
      "\source".$vendor_dir."\script".$vendor,
      // copy solar
     "\scrip\solar",
       // copy vendor
        "\script".$vendor_dir,
    );
} else {
  $dirs = array(
        // symlink solar
      "/source/solar/script/solar",
     // symlink vendor
     "/source/$vendor/script/$vendor",
     // copy solar
     "/scrip/solar",
       // copy vendor
        "/script/$vendor",
    );
}
</pre>


<p>
找到72行，把include-path修改为：
</p>


<pre class="example">
if ($system) {
    if (strtolower(substr(PHP_OS, 0, 3)) == 'win') {
       // windows doesn't like the default symlinks
       $include = "$system/include;$system/source/solar;.";
    } else {
       // unix, yay
       $include = "$system/include:.";
    }
} else {
    $include = get_include_path();
}
</pre>


<p>
现在你就可以在command里创建vendor、model和app了。
首先进入到script目录，然后使用命令make-***即可，如下：
</p>


<pre class="example">
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Users\ROY&gt;d:

D:\&gt;cd wamp\www\solar\script

D:\wamp\www\solar\script&gt;php solar make-model Acme_Model_Tosts --table blogs
Making model 'Acme_Model_Tosts'.
Will write to 'D:\wamp\www\solar\include\'.
Using table 'blogs'.
Not using inheritance.
Making class directory ... done.
Writing model class ... done.
Writing record class ... done.
Writing collection class ... done.
Connecting to database for metadata ...connected.
Fetching table cols ... done.
Fetching index info ... no indexes found.
Writing metadata class ... done.
Creating locale directory ... done.
Saving locale file for en_US ... done.
Done.
</pre>


<p>
当然，你需要先把php.exe的路径放到环境变量中，否是会提示command not found.
</p>

      </div>
    </div>
    <div> 
      <div class="post-meta">
        <span title="post date" class="post-info">2010-04-23</span>
        <span title="last modification date" class="post-info">2013-07-04</span>
        <span title="tags" class="post-info"><a href="/tags/solar/">solar</a>, <a href="/tags/solar-php/">solar php</a>, <a href="/tags/windows/">windows</a></span>
        <span title="author" class="post-info">Gu Weigang</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/2010/04/23/besides-windows-using-solar/";
          var disqus_url = "http://guweigang.com/blog/2010/04/23/besides-windows-using-solar/";
          var disqus_shortname = 'guweigang';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </section>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.0.3)</p>
        <p> 
          Copyright &copy; 2012 - 2013 <a href="mailto:guweigang &lt;at&gt; outlook &lt;dot&gt; com">Gu Weigang</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
        </p>
      </div>
    </div>
  </body>
</html>
